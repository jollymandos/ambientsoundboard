
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ambient Soundboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #000;
    color: white;
    overflow: hidden;
  }

  #bg1, #bg2 {
    position: fixed;
    inset: 0;
    background-size: cover;
    background-position: center;
    transition: opacity 1.5s ease-in-out;
  }

  #bg2 { opacity: 0; }

  .panel {
    position: absolute;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    padding: 14px 18px;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(8px);
    border-radius: 12px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }

  button {
    padding: 12px 20px;
    font-size: 16px;
    color: white;
    border: none;
    border-radius: 8px;
    background: rgba(255,255,255,0.15);
    cursor: pointer;
  }

  button:hover {
    background: rgba(255,255,255,0.25);
  }
</style>
</head>
<body>

<div id="bg1"></div>
<div id="bg2"></div>

<div class="panel">
  <button onclick="switchScene('sauron')">Sauron</button>
  <button onclick="switchScene('chaos')">Chaos</button>
  <button onclick="switchScene('freefolk')">Freefolk</button>
  <button onclick="switchScene('stewards')">Stewards</button>
</div>

<script>
/* ---------------------------------------------------------
   SCENE DEFINITIONS (use your real filenames)
--------------------------------------------------------- */
const scenes = {
  sauron:   { audio: new Audio("sauron.mp3"),   image: "sauron.png" },
  chaos:    { audio: new Audio("chaos.mp3"),    image: "chaos.png" },
  freefolk: { audio: new Audio("freefolk.mp3"), image: "freefolk.png" },
  stewards: { audio: new Audio("stewards.mp3"), image: "stewards.png" }
};

/* ---------------------------------------------------------
   INITIAL AUDIO SETTINGS
--------------------------------------------------------- */
for (const key in scenes) {
  const a = scenes[key].audio;
  a.loop = true;
  a.volume = 0;
}

/* ---------------------------------------------------------
   GLOBAL STATE
--------------------------------------------------------- */
let currentAudio = null;
let audioUnlocked = false;
let bgToggle = true;

/* ---------------------------------------------------------
   FADE FUNCTION
--------------------------------------------------------- */
function fade(audio, start, end, duration, onDone) {
  const steps = duration / 50;
  const delta = (end - start) / steps;
  let v = start;

  const id = setInterval(() => {
    v += delta;
    audio.volume = Math.min(1, Math.max(0, v));

    if ((delta > 0 && v >= end) || (delta < 0 && v <= end)) {
      clearInterval(id);
      audio.volume = end;
      if (onDone) onDone();
    }
  }, 50);
}

/* ---------------------------------------------------------
   SWITCH SCENE
--------------------------------------------------------- */
function switchScene(name) {
  const scene = scenes[name];
  const nextAudio = scene.audio;

  /* --- BACKGROUND FADE --- */
  const bgA = document.getElementById("bg1");
  const bgB = document.getElementById("bg2");

  if (bgToggle) {
    bgB.style.backgroundImage = `url(${scene.image})`;
    bgB.style.opacity = 1;
    bgA.style.opacity = 0;
  } else {
    bgA.style.backgroundImage = `url(${scene.image})`;
    bgA.style.opacity = 1;
    bgB.style.opacity = 0;
  }
  bgToggle = !bgToggle;

  /* --- AUDIO LOGIC --- */

  // If audio not unlocked yet, this click will unlock it.
  if (!audioUnlocked) {
    audioUnlocked = true;
  }

  // Capture the old audio BEFORE assigning currentAudio (critical!)
  const oldAudio = currentAudio;

  // Start the new audio
  nextAudio.currentTime = 0;
  nextAudio.play().catch(e => console.log("play blocked:", e));
  fade(nextAudio, 0, 1, 2000);

  // Fade out old audio SAFELY
  if (oldAudio && oldAudio !== nextAudio) {
    fade(oldAudio, oldAudio.volume, 0, 2000, () => {
      oldAudio.pause();  // only pauses the real old audio
    });
  }

  // Assign AFTER capture
  currentAudio = nextAudio;
}

/* ---------------------------------------------------------
   INITIAL BACKGROUND
--------------------------------------------------------- */
document.getElementById("bg1").style.backgroundImage = "url('sauron.png')";
</script>

</body>
</html>

